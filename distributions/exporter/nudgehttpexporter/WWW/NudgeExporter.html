<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{.Title}}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">-->
    <link rel="stylesheet" href="/files/NudgeExporter.css">
    <meta name="description" content="NudgeHttpExporter - Statistiques et configuration">
</head>
<body>
    <h2>{{.Title}} - {{.TimeNow}}</h2>
    <h3>Statistiques de NudgeHttpExporter</h3>
    <p>CPU: {{printf "%.2f" .CPU}}%</p>
    <span>Configuration actuelle de NudgeHttpExporter</span>
    <ul>
        <li>Endpoint <span class="comment">{{.Nudgehttp_Comments.Endpoint}}</span> : {{.Nudgehttp.NudgeHTTPClientConfig.Endpoint}}</li>
        <li>PathCollect <span class="comment">{{.Nudgehttp_Comments.PathCollect}}</span> : {{.Nudgehttp.PathCollect}}</li>
        <li>Method <span class="comment">{{.Nudgehttp_Comments.Method}}</span> : {{.Nudgehttp.Method}}</li>
        <li>Encoding <span class="comment">{{.Nudgehttp_Comments.Encoding}}</span> : {{.Nudgehttp.Encoding}}</li>
        <li>RecordCollecte <span class="comment">{{.Nudgehttp_Comments.RecordCollecte}}</span> : {{.Nudgehttp.RecordCollecte}}</li>
        <li>TimeoutBufferTransaction <span class="comment">{{.Nudgehttp_Comments.TimeoutBufferTransaction}}</span>: {{.Nudgehttp.TimeoutBufferTransaction}}</li>
        <li>ApplicationName <span class="comment">{{.Nudgehttp_Comments.ApplicationName}}</span>: {{.Nudgehttp.ApplicationName}}</li>
        <li>InsertResource <span class="comment">{{.Nudgehttp_Comments.InsertResource}}</span>: {{.Nudgehttp.InsertResource}}</li>
        <li>PrefixeServiceName <span class="comment">{{.Nudgehttp_Comments.PrefixeServiceName}}</span>: {{.Nudgehttp.PrefixeServiceName}}</li>
        <li>SendUserConnectionString <span class="comment">{{.Nudgehttp_Comments.SendUserConnectionString}}</span>: {{.Nudgehttp.SendUserConnectionString}}</li>
    </ul>
        <br/>
    <table>
        <caption>Statistiques de NudgeHttpExporter</caption>
        <colgroup>
            <col style="width: 20%;">
            <col style="width: 40%;">
            <col style="width: 20%;">
            <col style="width: 20%;">
        </colgroup>
        <thead>
            <tr>
                <th>Statistiques</th>
                <th>Application ID de Nudge</th>
                <th>Transactions</th>
                <th>Taille</th>
            </tr>
        </thead>
        <tbody>
            {{range $key, $value := .Stats}}
            <tr>
                <td title="{{$value.comment}}">{{$key}}</td>
                <td title="{{$value.comment}}">{{$value.identifiant}}</td>
                <td>{{$value.value}}</td>
                <td class="format-nombre" data-value="{{index $value.values 0}}"></td>
            </tr>
            {{end}}
        </tbody>
    </table>
</body>
<script>
    const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
            if (mutation.type === 'attributes' && mutation.attributeName === 'data-value') {
            const el = mutation.target;
            const val = el.dataset.value;
            const n = parseInt(val);
            el.textContent = isNaN(n) ? '' : n.toLocaleString('fr-FR');
            }
        });
    });

    document.querySelectorAll('.format-nombre').forEach(el => {
    observer.observe(el, { attributes: true });
    });

    document.querySelectorAll('.format-nombre').forEach(span => {
        const n = parseInt(span.dataset.value);
        span.textContent = n.toLocaleString('fr-FR'); // "1 234 567 890"
    });
</script>
</html>